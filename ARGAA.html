<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"> 
  <title>Test</title>

</head>

<body>
<link rel="stylesheet" type="text/css" href="ARGAA.css" media="screen" />

<div id="top">
   <a href="https://obyte.org/" target="_blank"> <img src="https://static.ucraft.net/fs/userFiles/byteball/images/100-obyte-blue-175x124.png"/></a>
</div>

<form class="form-style-7">
	<h1> Welcome to ARGAA, A Renting Guarantee Autonomous Agent powered by the Obyte Open-Ledger </h1>
	<ul>
		<li>
			<label for="name">AA address to use: </label>
			<input name="aa" type="text" id="aa" maxlength="32" value="IRMDUTCPHBAS4Z5EDIGBSHPB57GBNYPU" />
			<span>The renting guarantee is securized by an Autonomous Agent powered by Obyte. 
			Its definition can be reviewed <a href="https://testnetexplorer.obyte.org/#IRMDUTCPHBAS4Z5EDIGBSHPB57GBNYPU">here</a>. 
			You can specify an other address if you know a better version. </span>
		</li> <li> </li>
	</ul>
	<h1>  Lock a new guarantee for a rented item <br> </h1>
	<ul>  Make sure you are using single address wallet, if not your address will constantly change and the AA will not recognise you.<br><br>
		<li>
			<label for="email">Owner Obyte address: </label>
			<input name="owner" type="text" id="owner" maxlength="32" value="35IT3ZYKEPQSCXG2F7A7KWNRAD3SZXN4" placeholder="35IT3ZYKEPQSCXG2F7A7KWNRAD3SZXN4"/><br />
			<span>Please enter the Obyte address (from a single-address wallet) of the owner of the rented item.</span>
		</li>
		<li>
			<label for="url">Name of the guarantee:</label>
			<input name="name" type="text" id="name" placeholder="my_account" maxlength="128" /><br />
			<span>Enter a unique name for the guarantee, the name will be needed later to identify the guarantee when it will be time find agreement on how to re-distribute the guarantee amount.</span>
		</li>
		<li>
			<label for="bio">Guarantee amount in bytes:</label>
			<input name="amount" type="text" id="amount" value = 5000 placeholder=5000/>
			<span>Please enter the amount of bytes required by the owner. 10 000 bytes of AA fee will be automatically added.</span>
		</li>
		<li>
			<input name="btn_create" id="create" type="submit" value="Open Obyte Wallet with pre-filled transaction to AA" >
		</li>
	</ul>
	<h1> <br> <br>  Make a proposition to unlock an existing guarantee <br> 
	</h1>
	<ul>	
		Make sure you are using the same wallet that the one you used to during the creation of the guarantee.<br><br>
		<li>
			<label for="url">Name of the guarantee:</label>
			<input name="name2" type="text" id="name2"  maxlength="128" placeholder="my_account"/><br />
			<span>Enter the unique name of the existing guarantee.</span>
		</li>
		<li>
			<label for="bio">Amount of byte to release for the other party:</label>
			<input name="amount2" type="text" id="amount2"  placeholder = 10000 />
			<span>Please enter the amount of bytes from the guarantee amount that you are ready to give up to the other party. 
			If the other party release the other part, the AA will distribute both amounts to parties. 
			The sum of both propositions must be equal to the total value of the guarantee.
			You can check in the state of the AA, 
			<a href="https://testnetexplorer.obyte.org/#IRMDUTCPHBAS4Z5EDIGBSHPB57GBNYPU">the guarantee amount</a>
			('account name'_guarantee: 'amount') as well as the existing (or not) 
			<a href="https://testnetexplorer.obyte.org/#IRMDUTCPHBAS4Z5EDIGBSHPB57GBNYPU">propositions</a> 
			('account name'_proposition: 'amount')</span>
		</li>
		<li>
			<input name="btn_proposition" id="proposition" type="submit" value="Open Obyte Wallet with pre-filled transaction to AA" >
		</li>
	</ul>
</form>

<div id="text_link"></div>
<div id="bottom" align=center>
	<a href="https://github.com/pascalSAINVITU/ARGAA" target="_blank"> <img id="img1" src="https://obyte.org/static/images/github_footer_img.png" size=50%/></a>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script type="text/javascript">

function get64basedData (data)
{
	let json_string = JSON.stringify(data);
	let encodedString = btoa(json_string);
	
	let lastchar = encodedString.substring(encodedString.length - 1);
	
	let base64;
	if (lastchar === '=')
		base64= encodedString.substring(0, encodedString.length - 1);
	else
		base64= encodedString
		
	console.log("base64: "+base64);
	
	return base64;
}

$("#create").on("click", function (e){
	e.preventDefault();
	
	console.log("account_name: " + $("#name").val());
	
	let data = {
		create: 1,
		account_name: $("#name").val(),
		owner: $("#owner").val(),
	};
	
	var guarantee_amount = parseInt($("#amount").val());
	
	var total_amount = guarantee_amount + 10000;
	
	var byteball_link = "byteball-tn:" + $("#aa").val() + "?amount=" + total_amount + "&base64data=" + get64basedData(data);
	// to see the log in the console, press F12
	console.log("byteball_link: "+byteball_link);

	//print the text in <div id="text_link"></div>
	//$("#text_link").html(txt);

	//redirect browser window to the encoded url - uncomment:	
	//window.location.href = txt;	
	window.open( byteball_link, '_blank' );
		
});

$("#proposition").on("click", function (e){
	e.preventDefault();
	
	let data = {
		account_name: $("#name2").val(),
		proposition: $("#amount2").val(),
	};
	
	var byteball_link2 = "byteball-tn:" + $("#aa").val() + "?amount=" + 10000 + "&base64data=" + get64basedData(data);
	
	// to see the log in the console, press F12
	console.log("byteball_link: "+ byteball_link2);

	//print the text in <div id="text_link"></div>
	//$("#text_link").html(txt);

	//redirect browser window to the encoded url - uncomment:	
	window.location.href = byteball_link2;	
		
});
</script>
</body>
</html>
